---
title: üîíBr0k3n 4cc3ss C0ntr0l
author: Gabriel Fernandes
date: 2025-03-12
categories: [OWASP Top 10]
tags: [Sites, Web, Vuln]
---


# ‚ö†Ô∏è O que √© Broken Access Control?

Refere-se a falhas em mecanismos que deveriam restringir o acesso a recursos ou funcionalidades de uma aplica√ß√£o. Isso significa que os usu√°rios podem acessar, modificar ou excluir dados ou funcionalidades que n√£o est√£o autorizados a ver ou manipular. √â uma das vulnerabilidades mais comuns e cr√≠ticas em aplica√ß√µes web, frequentemente listada entre as principais amea√ßas no **OWASP Top 10**.

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Owasp.png "OWASP")

# üîç Como posso encontrar?
### 1. Escalonamento Horizontal

**Descri√ß√£o**: Um usu√°rio acessa dados de outro usu√°rio que n√£o deveria ser capaz de acessar, geralmente manipulando par√¢metros na URL ou no corpo da requisi√ß√£o.

**Exemplo de C√≥digo Vulner√°vel**:

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/horizontal-attack.png "Horizontal Attack")

**Explora√ß√£o**: Um atacante pode alterar o `user_id` na URL, por exemplo, de `http://exemplo.com/user.php?user_id=1` para `http://exemplo.com/user.php?user_id=2` e acessar dados de outro usu√°rio.

### 2. Escalonamento Vertical

**Descri√ß√£o**: Um usu√°rio comum consegue realizar a√ß√µes administrativas que deveriam ser restritas a administradores.

**Exemplo de C√≥digo Vulner√°vel**:

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Vertical-attack.png "Vertical Attack")

**Explora√ß√£o**: Um usu√°rio normal pode executar essa a√ß√£o se souber manipular o formul√°rio e enviar uma requisi√ß√£o POST para excluir um usu√°rio.

### 3. Controle de Vulnerabilidade de Acesso em M√∫ltiplos Estados de Processo

**Descri√ß√£o**: Um usu√°rio manipula o estado de uma transa√ß√£o sem a devida valida√ß√£o.

**Exemplo de C√≥digo Vulner√°vel**:

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Multiplos-escalo-attack.png "Multiplos Escalonamento Attack")

**Explora√ß√£o**: Um usu√°rio pode manipular o `order_id` para alterar o status de um pedido que n√£o lhe pertence, finalizando compras indevidas.

### Conclus√£o

Esses exemplos ilustram como o **Broken Access Control** pode ser explorado em aplica√ß√µes PHP e como implementar pr√°ticas de seguran√ßa para proteger seus sistemas. As verifica√ß√µes de permiss√£o e a valida√ß√£o de estados s√£o cruciais para evitar acessos n√£o autorizados. Se precisar de mais informa√ß√µes ou exemplos adicionais, √© s√≥ avisar!

# üîë Como posso explorar essa vulnerabilidade?

Este laborat√≥rio armazena logs de bate-papo do usu√°rio diretamente no sistema de arquivos do servidor e os recupera usando URLs est√°ticas.

Resolva o laborat√≥rio descobrindo a senha do usu√°rio¬†`carlos`e efetuando login na conta dele.

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Lab-carlos.png "Lab - Portswigger")

### **1Ô∏è‚É£ Identifica√ß√£o da funcionalidade vulner√°vel**

- O site fornece um **chat ao vivo** onde as mensagens trocadas entre usu√°rios s√£o armazenadas e podem ser baixadas como um **arquivo de transcript** (`.txt`).
- Observamos que h√° uma op√ß√£o **"View transcript"** para baixar o hist√≥rico do chat.
- O n√∫mero antes da extens√£o `.txt` indica um identificador √∫nico para cada transcript

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Live-chat.png "Live Chat")


![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Arquivo-txt.png "Arquivo .TXT")

### 2Ô∏è‚É£ **Explora√ß√£o da vulnerabilidade IDOR**

- A vulnerabilidade ocorre porque o sistema **n√£o valida se o usu√°rio tem permiss√£o para acessar um transcript espec√≠fico**.
- Podemos testar manualmente se conseguimos acessar arquivos de outras sess√µes do chat, modificando o identificador na URL:
- Para verificar isso de forma mais eficiente, utilizamos o Burp Suite para interceptar a requisi√ß√£o e modificar o identificador.

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Recon-IDOR.png "Recon IDOR")

### **3Ô∏è‚É£ Uso do Burp Suite para automa√ß√£o do ataque**

#### **Intercepta√ß√£o da requisi√ß√£o**

- No **Burp Suite**, acessamos a aba **Proxy** e capturamos a requisi√ß√£o `GET /download-transcript/2.txt HTTP/2`.
- Enviamos essa requisi√ß√£o para o **Repeater**, onde podemos test√°-la manualmente.

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Repter.png "BurpSuite - Repeater")

#### **Manipula√ß√£o do ID do transcript**

- Alteramos a requisi√ß√£o `GET` no **Repeater**, mudando `2.txt` para `1.txt`:
- Enviamos a requisi√ß√£o novamente.
- O servidor retorna um arquivo que pertence a outro usu√°rio.
### 4Ô∏è‚É£ **Exposi√ß√£o de senha**

- No conte√∫do do transcript `1.txt`, encontramos uma conversa onde um usu√°rio compartilha sua senha para confirma√ß√£o:
    
    `You: Ok so my password is cep12xuxsha2ppv428j. Is that right? Hal Pline: Yes it is!`
    
- Esse √© um caso cl√°ssico de **engenharia social** dentro de um sistema vulner√°vel.

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Expondo-password.png "Password")

### **5Ô∏è‚É£ Login como o usu√°rio alvo**

- Agora que temos a senha `cep12xuxsha2ppv428j`, verificamos o objetivo do desafio:
    - No enunciado do laborat√≥rio, a miss√£o √© **acessar a conta do usu√°rio "carlos"**.
- Usamos essas credenciais para tentar o login na plataforma como **carlos**

![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Login.png "Login")


![alt text](/assets/img/Br0k3n 4cc3ss C0ntr0l/Sucesso-login.png "Sucesso")